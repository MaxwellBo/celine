<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>@celine/celine</title>

  <link rel="stylesheet" href="stylesheets/libertine.css" />
  <link rel="stylesheet" href="stylesheets/cell.css" />
  <meta name="theme-color" content="#ffffff">

  <link rel="apple-touch-icon" sizes="180x180" href="static/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="static/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="static/favicon-16x16.png">
  <link rel="manifest" href="static/site.webmanifest">

  <meta name="description" content="A library for building reactive HTML notebooks with inline contenteditable &lt;script&gt;s">
  <meta name="author" content="Max Bo">
  <meta name="keywords" content="celine, celine, reactive, html, notebook, observable, runtime, api, library, esm, module, script, style, element, contenteditable, reevaluate, blur, cell, viewof, mutable, counter, fizzbuzz, name, greeting, ref, increment, sword">
  <meta name="date" content="2024-09-18">
  <meta name="license" content="MIT">
  
  <meta property="og:title" content="@celine/celine">
  <meta property="og:description" content="A library for building reactive HTML notebooks with inline contenteditable &lt;script&gt;s">
  <meta property="og:url" content="https://maxbo.me/celine/">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Max Bo">
  <meta property="og:image" content="https://maxbo.me/celine/static/og.png">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:creator" content="@_max_bo_">
  <meta name="twitter:title" content="@celine/celine">
  <meta name="twitter:description" content="A library for building reactive HTML notebooks with inline contenteditable &lt;script&gt;s">
  <meta name="twitter:image" content="https://maxbo.me/celine/static/og.png">
  <meta name="twitter:card" content="summary_large_image">
</head>

<body>
<main>
<h1 class="title">@celine/celine</h1>

<div class="authors">
  <div class="author">
    <span class="author-name">Max Bo</span> <sup><a href="https://maxbo.me" style="text-decoration: none;">↗</a></sup>
  </div>
</div>

<section class="abstract">
<p><cite>@celine/celine</cite> is library for building reactive HTML notebooks with <code>display: block</code> <code>contenteditable</code> <code>&lt;script&gt;</code> elements. 
  It wraps a subset of the <a href="https://observablehq.com/documentation/notebooks/">Observable Notebook</a> <a href="https://github.com/observablehq/runtime">runtime</a> to power inter-cell reactivity, just like <a href="https://observablehq.com/framework/reactivity">Observable Framework</a> and <a href="https://quarto.org/docs/interactive/ojs/">Quarto</a>.

<p>
  I initially considered calling this library <i>incel</i>, short for <q>inline cell</q>, but was advised against it.
</p> 

<style>
@keyframes bounce {
  0%, 20%, 50%, 80%, 100% {
    transform: translateY(0);
  }
  40% {
    transform: translateY(-2px);
  }
  60% {
    transform: translateY(-1px);
  }
}

.bounce {
  animation: bounce 2s infinite;
}
</style>
<p class="bounce"><a href="#demo"><b>Jump straight to the demo?</a></b></p>
</section>
<table class="header">
  <tbody>
    <tr>
      <th>GitHub</th>
      <td class="width-auto"><a href="https://github.com/MaxwellBo/celine">MaxwellBo/<wbr>celine</a><span id="stars"></span> + <a href="https://github.com/MaxwellBo/celine/issues">/issues</a> </td> 
      <th class="width-min">License</th>
      <td><a href="https://github.com/MaxwellBo/celine/blob/master/LICENSE">MIT</a></td>
    </tr>
    <script type="module">
      // ping the GitHub API for the number of stars
      fetch("https://api.github.com/repos/MaxwellBo/celine")
        .then(d => d.json())
        .then(resp => {
          const stars = resp.stargazers_count;
          document.getElementById("stars").textContent = ` (⭐ ${stars})`;
        })
    </script>
    <tr>
      <th>JSR</th>
      <td class="width-auto"><a href="https://jsr.io/@celine/celine">jsr.io/<wbr>@celine/<wbr>celine</a> + <a href="https://jsr.io/@celine/celine/doc">/docs</a></td>
      <th>Version</th>
      <!-- these should be updated to the best of your ability -->
      <td class="width-min"><a href="https://jsr.io/@celine/celine/versions" id="version">1.0.0</a>, <time  id="updated">Oct 15 2024</time></td>
    </tr>
    <script type="module">
      fetch("https://npm.jsr.io/@jsr/celine__celine")
        .then(d => d.json())
        .then(resp => {
          const latestVersion = resp["dist-tags"].latest;
          document.getElementById("version").textContent = latestVersion;
          const date = new Date(resp.time[latestVersion]);
          const formattedDate = `${date.toLocaleString('default', { month: 'short' })} ${date.getDate()} ${date.getFullYear()}`;
          document.getElementById("updated").textContent = formattedDate;
        })
    </script>
  </tbody>
</table>
<br />

<h2 id="toc"><a href="#toc" id="toc"></a>Table of Contents</h2>

<div class="table-of-contents" id="toccontainer">
</div>

<script type="module">
  document.addEventListener("DOMContentLoaded", () => {
    const toc = document.getElementById("toccontainer");
    const headers = document.querySelectorAll("h2, h3, h4, h5, h6");
    
    // Create an object to store the current ol element at each level
    const levels = {};
    let prevLevel = 1;  // Start with h2 (level 1)
    
    headers.forEach(header => {
      const level = parseInt(header.tagName.substring(1)) - 2;  // Convert h2-h6 to 0-4
      
      // If going deeper, create new ol
      if (level > prevLevel) {
        const parentLi = levels[prevLevel].lastElementChild;
        const newOl = document.createElement("ol");
        parentLi.appendChild(newOl);
        levels[level] = newOl;
      }
      
      // If going back up, remove references to deeper levels
      if (level < prevLevel) {
        for (let i = prevLevel; i > level; i--) {
          delete levels[i];
        }
      }
      
      // Create list item with link
      const li = document.createElement("li");
      const a = document.createElement("a");
      a.href = `#${header.querySelector('a').id}`;
      a.innerHTML = header.innerHTML;
      // Remove the anchor links
      a.querySelectorAll('a[href^="#"]').forEach(link => link.remove());

      li.appendChild(a);
      
      // Add to the appropriate ol
      if (!levels[level]) {
        const newOl = document.createElement("ol");
        toc.appendChild(newOl);
        levels[level] = newOl;
      }
      levels[level].appendChild(li);
      
      prevLevel = level;
    });
  });
</script>

<h2><a href="#installation" id="installation"></a>Installation</h2>

<p>Add the following <code>&lt;script&gt;</code> element to your HTML file's <code>&lt;head&gt;</code> block:</p> 

<script type="module" class="echo reflect" id="installation">
import { CelineModule, reevaluateOnBlur } from 'https://esm.sh/jsr/@celine/celine@1.0.0';
import * as Inputs from 'https://esm.run/@observablehq/inputs@0.12.0';
import * as htl from 'https://esm.run/htl@0.3.1';

window.celine = CelineModule.usingNewObservableRuntimeAndModule(document);
window.library = celine.library; /* @observablehq/stdlib */
window.Inputs = Inputs;
window.htl = htl;

reevaluateOnBlur(document, /*class=*/'echo');
</script>

<style>
script#installation::before {
  content: "<script type=\"module\">";
  display: block;
}
</style>

<p>Link <a href="#.echo">cell.css</a> in your <code>&lt;head&gt;</code> block:</p>

<pre class="echo" style="margin-bottom: 1ch;">
&lt;link 
  rel=&quot;stylesheet&quot; 
  href=&quot;https://esm.sh/jsr/@celine/celine@1.0.0/stylesheets/cell.css?raw&quot; /&gt;
</pre>

<p>
You may want to include <cite>@celine/celine</cite>'s <a href="https://dohliam.github.io/dropin-minimal-css/">drop-in stylesheet</a>, <a href="#libertine.css">libertine.css</a>:
</p>

<pre class="echo" style="margin-bottom: 1ch;">
&lt;link 
  rel=&quot;stylesheet&quot; 
  href=&quot;https://esm.sh/jsr/@celine/celine@1.0.0/stylesheets/libertine.css?raw&quot; /&gt;
</pre>

<h2><a href="#demo" id="demo"></a>Demo: Observable Plot + SQLite</h2>

<p><i>Try removing a <code>0</code> from the <code>WHERE</code> condition, then click away from the <code>&lt;script&gt;</code> to <abbr title="lose focus">blur</abbr> and reevaluate.</i></p>

<script type="module" class="echo reflect" id="chinook" contenteditable="true">
import * as Plot from 'https://esm.run/@observablehq/plot@0.6.16';

celine.cell("chinook", async () => {
  const url = "https://maxbo.me/chinook.db";
  const db = await library.SQLiteDatabaseClient().open(url);
  const tracks = await db.query("SELECT * FROM tracks WHERE Milliseconds < 1000000");

  return Plot.plot({
    title: htl.html`<h3>Track length distribution</h3>`,
    marks: [
      Plot.rectY(
        tracks,
        Plot.binX({ y: "count" }, { x: "Milliseconds", tip: true })
      ),
      Plot.ruleY([0])
    ]
  });
});
</script>


<h2><a href="#api" id="api"></a>API</h2>
<p>The following <code>&lt;styles&gt;</code>s are marked <code>contenteditable</code> and reevaluate on edit.</p>

<h3><a href="#.echo" id=".echo"></a><code>.echo</code></h3>

<p>The <code>.echo</code> class can display <code>&lt;script&gt;</code> and <code>&lt;style&gt;</code> elements inline, using a <a href="https://blog.glyphdrawing.club/font-with-built-in-syntax-highlighting/"><cite>font with built-in syntax highlighting</cite></a>.</p>

<style class="echo" id="echo-style" contenteditable="true">#echo-style {
  border: 3px solid fuchsia;
}
</style>

<h3><a href="#.reflect" id=".reflect"></a><code>.reflect</code></h3>

<p>The <code>.reflect</code> class forces <code>&lt;script&gt;</code> and <code>&lt;style&gt;</code> elements to display their opening and closing tags, <code>type</code>, <code>class</code>, <code>id</code>, and <code>contenteditable</code> attributes (a little trick from <a href="https://secretgeek.github.io/html_wysiwyg/html.html"><cite>This page is a truly naked, brutalist html quine</cite></a>).</p>

<style class="echo reflect" id="reflect-style" contenteditable="true">
#reflect-style {
  border: 3px solid lime;
}
</style>

<p>All of the following <code>&lt;script&gt;</code>s are marked <code>contenteditable</code> and reevaluate on <abbr title="loss of focus">blur</abbr>.</p>

<h3><a href="#cell" id="cell"></a><code>celine.cell(name, [inputs, ]definition)</code></h3>

<p>The <code>cell</code> constructor declares a reactive cell called <code>"${name}"</code>.</p>

<p>The <code>definition</code> can be <code>T</code> or <code>(...inputs) => T</code>, where <code>T</code> can be <code>object</code>, <code>Promise&lt;?&gt;</code>, <code>Iterator&lt;?&gt;</code>, or <code>AsyncIterator&lt;?&gt;</code>.</p>

<p>Cells render their current value above an element that has an <code>id</code> the same as the cell's <code>name</code>. Thus, to render the counter value above the <code>&lt;script&gt;</code>, we set <code>id="counter"</code> on the <code>&lt;script&gt;</code>:</p>

<script type="module" class="echo reflect" id="counter" contenteditable="true">
celine.cell("counter", async function* () {
  let i = 0;
  while (true) {
    await library.Promises.delay(1000);
    yield i++;
  }
});
</script>

<p>The <code>cell</code> constructor accepts <code>inputs</code>, a list of other cell names to depend on.</p></p>
<p>Here we use <a href="https://observablehq.com/@observablehq/htl">Hypertext Literal</a>'s <code>html</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals">template literal</a>, to transform the value of another cell:</p>

<script type="module" class="echo reflect" id="fizzbuzz" contenteditable="true">
celine.cell("fizzbuzz", ["counter"], (counter) => {
  if (counter % 3 === 0 && counter % 5 === 0) {
    return htl.html`<b style="color: purple">FizzBuzz</b>`;
  } else if (counter % 3 === 0) {
    return htl.html`<b style="color: red">Fizz</b>`;
  } else if (counter % 5 === 0) {
    return htl.html`<b style="color: blue">Buzz</b>`;
  } else {
    return htl.html`<b>${counter}</b>`;
  }
});
</script>

<p>A <code>&lt;script&gt;</code> declaring a cell can be hidden inside a <code>&lt;details&gt;</code>s element.</p>

<details id="hue">
  <summary>Show code</summary>
<script type="module" class="echo reflect" contenteditable="true">
celine.cell("hue", async function* () {
  let hue = 0;
  while (true) {
    await library.Promises.delay(100);
    yield htl.html`<span style="color: hsl(${hue}, 100%, 40%);">
      Hello from inside the &lt;details&gt; element
    </span>`;
    hue = (hue + 10) % 360;
  }
});
</script>
</details>

<br />

<p>To display the cell's current value above the <code>&lt;details&gt;</code> element, rather than above the <code>&lt;script&gt;</code>, we add <code>id="hue"</code> to the <code>&lt;details&gt;</code> element, as the cell's <code>name</code> is <code>"hue"</code>:</p>

<pre class="echo">
&lt;details id=&quot;hue&quot;&gt;
  &lt;summary&gt;Show code&lt;/summary&gt;
  &lt;script type=&quot;module&quot; class=&quot;echo reflect&quot; contenteditable=&quot;true&quot;&gt;
  celine.cell(&quot;hue&quot;, async function* () {
    // implementation elided for brevity
  &lt;/script&gt;
&lt;/details&gt;
</pre>


<h3><a href="#viewof" id="viewof"></a><code>celine.viewof(name, [inputs, ]definition)</code></h3>

<p>The <code>viewof</code> constructor is a special constructor designed to work with <a href="https://github.com/observablehq/inputs">Observable Inputs</a>.</p>

<p><p>It declares 2 reactive cells: a cell called <code>"${name}"</code>, and a cell called <code>"viewof ${name}"</code> - one for the value, and one for the DOM element itself.</p>

<p>To display the DOM element above another element <code>&lt;script&gt;</code>, set <code>id="viewof ${name}"</code> on the element to which the input should be prepended.</p>

<p>Here, we want to display an input above the <code>&lt;script&gt;</code> element, so we set <code>id="viewof password"</code> on the <code>&lt;script&gt;</code>:</p>

<script type="module" class="echo reflect" id="viewof password" contenteditable="true">
celine.viewof("password", () => {
  return Inputs.text({ label: "Password", placeholder: "hunter2" });
});
</script>

<p>We still have to depend on the cell called <code>"password"</code> to use the input's value:</p>

<script type="module" class="echo reflect" id="strength" contenteditable="true">
celine.cell("strength", ["password"], (password) => {
  // please don't use this for real password strength checking
  if (password.length >= 12) {
    return htl.html`<b style="color: green">Strong</b>`;
  } else if (password.length >= 10) {
    return htl.html`<b style="color: lime">Fairly Strong</b>`;
  } else if (password.length >= 8) {
    return htl.html`<b style="color: orange">Medium</b>`;
  } else if (password.length >= 6) {
    return htl.html`<b style="color: gold">Weak</b>`;
  } else if (password.length >= 4) {
    return htl.html`<b style="color: red">Very Weak</b>`;
  } else {
    return htl.html`<b style="color: darkred">Extremely Weak</b>`;
  }
});
</script>

<p>For further information on how to create custom inputs, see the <a href="https://observablehq.com/@observablehq/synchronized-inputs"><cite>Synchronized Inputs</cite></a> guide.</p>


<h3><a href="#silent" id="silent"></a><code>celine.silentCell(name, [inputs, ]definition)</code></h3>

<p>The <code>silentCell</code> constructor declares a cell that doesn't try to display its current value anywhere.</p>

<script type="module" class="echo reflect" id="silent" contenteditable="true">
celine.silentCell("silent", () => {
  return "This string does NOT render anywhere, but can be used by other cells.";
});
</script>


<h3><a href="#mutable" id="mutable"></a><code>celine.mutable(name, value)</code> / <code>celine.silentMutable(name, value)</code></h3>

<p>The <code>mutable</code> (and <code>silentMutable</code>) constructor declares a cell <em>and</em> returns a reference that can be mutated. Mutations propagate to cells that depend upon it.</p>

<script type="module" class="echo reflect" id="ref" contenteditable="true">
window.ref = celine.mutable("ref", 3)
</script>


<script type="module" class="echo reflect" id="viewof increment" contenteditable="true">
celine.viewof("increment", () => {
  const increment = () => ++ref.value;
  const reset = () => ref.value = 0;

  return Inputs.button([["Increment", increment], ["Reset", reset]]);
});
</script>

<script type="module" class="echo reflect" id="sword" contenteditable="true">
celine.cell("sword", ["ref"], (ref) => {
  return htl.html`↜(╰ •ω•)╯ |${'═'.repeat(ref)}═ﺤ`
});
</script>


<h3><a href="#library" id="library"></a><code>celine.library</code> / Observable standard library</h3>

<p>There are many useful utilities in the <a href="https://github.com/observablehq/stdlib">Observable standard library</a>. Inspect the contents of the <code>celine.library</code> object:</p>

<script type="module" class="echo reflect" id="lib" contenteditable="true">
celine.cell("lib", () => {
  return celine.library;
});
</script>

<h4><a href="#tex" id="tex"></a>TeX</h4>

<script type="module" class="echo reflect" id="eq1" contenteditable="true">
celine.cell("eq1", async () => {
  const tex = await celine.library.tex();
  return tex`c = \pm\sqrt{a^2 + b^2}`;
});
</script>

<h5><a href="#celine_tex" id="#celine_tex"></a><code>celine.tex</code></h5>

<p>Because rendering TeX is so useful, <cite>@celine/celine</cite> has a shorthand constructor, <code>celine.tex</code>:</p>

<script type="module" class="echo reflect" id="eq2" contenteditable="true">
celine.cell("eq2", celine.tex`c = \pm\sqrt{a^2 + b^2}`);
</script>

<p>Because cells render their contents <code>display: inline</code> (<i>celine ⇒ <q>cell inline</q></i>), we can embed the script <script type="module"  class="echo reflect" id="eq3" contenteditable="true">celine.cell("eq3", celine.tex`c = \pm\sqrt{a^2 + b^2}`)</script> in the middle of the <code>&lt;p&gt;</code> element.</p>

<p>In non-demonstration use, we'd also leave off the <code>.echo</code> and <code>.reflect</code> classes, to render <script type="module" id="eq4">celine.cell("eq4", celine.tex`c = \pm\sqrt{a^2 + b^2}`)</script> inline.</p>

<p>T render it centered, wrap the <code>&lt;script&gt;</code> with a <code>&lt;div style="text-align: center"&gt;</code>:</p>

<div style="text-align: center; margin-top: 1ch;">
<script type="module" id="eq5" contenteditable="true">
celine.cell("eq5", celine.tex`c = \pm\sqrt{a^2 + b^2}`);
</script>
</div>

<h4><a href="#markdown" id="markdown"></a>Markdown</h4>

<script type="module" class="echo reflect" id="md" contenteditable="true">
celine.cell("md", async () => {
  const elements =  [
    { "symbol": "Co", "name": "Cobalt", "number": 27 },
    { "symbol": "Cu", "name": "Copper", "number": 29 },
    { "symbol": "Sn", "name": "Tin", "number": 50 },
    { "symbol": "Pb", "name": "Lead", "number": 82 }
  ];

  const md = await celine.library.md();
  return md`
| Name      | Symbol      | Atomic number |
|-----------|-------------|---------------|${elements.map(e => `
| ${e.name} | ${e.symbol} | ${e.number}   |`)}
`;
});
</script>

<h5><a href="#celine_md" id="celine_md"></a><code>celine.md</code></h5>

<p>Markdown also has a shorthand constructor, <code>celine.md</code>:</p>

<script type="module" class="echo reflect" id="md2" contenteditable="true">
celine.cell("md2", celine.md`
  1. I
  2. love
  3. simple
  4. lists
`);
</script>

<h4><a href="#graphviz" id="graphviz"></a>Graphviz</h4>

<script type="module" class="echo reflect" id="dot" contenteditable="true">
celine.cell("dot", async () => {
  const dot = await celine.library.dot();
  return dot`
digraph G {
  rankdir = LR
  a -> b -> c
}`;
});
</script>

<h4><a href="#mermaid" id="mermaid"></a>Mermaid</h4>

<script type="module" class="echo reflect" id="cmermaid" contenteditable="true">
celine.cell("cmermaid", async () => {
  const mermaid = await celine.library.mermaid();
  return mermaid`
graph TD;
  A-->B;
  A-->C;
  B-->D;
  C-->D;
`;
});
</script>

<h4><a href="#leaflet" id="leaflet"></a>Leaflet</h4>

<script type="module" class="echo reflect" id="L" contenteditable="true">
celine.cell("L", async function* () {
  const L = await celine.library.L();
  const container = htl.html`<div id="map" style="height: 300px;"></div>`;
  yield container;

  const map = L.map(container).setView([-33.8688, 151.2093], 13);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(map);
});
</script>

<h3><a href="#libertine.css" id="libertine.css"></a>libertine.css</h3>

<p><cite>@celine/celine</cite> ships with a stylesheet based around the <a href="https://en.wikipedia.org/wiki/Linux_Libertine">Linux Libertine</a> typeface (more specifically Libertinus Serif from the <a href="https://github.com/alerque/libertinus"><cite>Libertinus font family</cite></a> fork).</p>

<p>Linux Libertine is common in academic typesetting - it's the <abbr title="lmao: 'Fonts used in the template CANNOT be substituted; margin adjustments are not allowed.'">mandatory</abbr> font for the <a href="https://www.acm.org/publications/proceedings-template">ACM LaTeX</a> conference paper theme, the default for <a href="https://typst.app/">Typst</a> and <a href="https://nota-lang.org/">Nota</a> papers, and an alternate font for <a href="https://latex.vercel.app/">LaTeX.css</a>.

<p>The <a href="fonts/Libertinus/documentation/libertinus.css">libertinus.css</a> stylesheet provides authoritative documentation on the available font faces, variants, and <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_fonts/OpenType_fonts_guide">OpenType features</a>, with <a href="fonts/Libertinus/documentation/Opentype-Features.pdf">Opentype-Features.pdf</a> as a demo page.</p>

<p><code>font-feature-settings: 'liga', 'tnum', 'zero' 'calt';</code> (ligatures, <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/font-variant-numeric">tabular figures</a>, slashed zero &amp; contextual alternatives) are enabled by default.</p>

<blockquote>
fi fl ffi ffl
<br />
1234567890
<br />
Quest, (staff)
<br />
H<sub>2</sub>O, E = mc<sup>2</sup>
</blockquote>

<p><a href="fonts/Libertinus/documentation/libertinus.css">libertinus.css</a> makes a number of faces available:</p>

<blockquote style="font-family: 'Libertinus Serif', serif;">
  Libertinus Serif<br />
  Sphinx of black quartz, judge my vow.<br />
  <i>Sphinx of black quartz, judge my vow.</i><br />
  <b>Sphinx of black quartz, judge my vow.</b><br />
  <i><b>Sphinx of black quartz, judge my vow.</b></i><br />
  <span style="font-variant: small-caps;">Small caps.</span><br />
  <span style="font-variant: all-small-caps;">All small caps.</span><br />
</blockquote>

<blockquote style="font-family: 'Libertinus Sans', sans-serif;">
  Libertinus Sans<br />
  Sphinx of black quartz, judge my vow.<br />
  <i>Sphinx of black quartz, judge my vow.</i><br />
  <b>Sphinx of black quartz, judge my vow.</b><br />
  <i><b>Sphinx of black quartz, judge my vow.</b></i><br />
  <span style="font-variant: small-caps;">Small caps.</span><br />
  <span style="font-variant: all-small-caps;">All small caps.</span><br />
</blockquote>

<blockquote style="font-family: 'Libertinus Display', serif;">
  Libertinus Display<br />
  Sphinx of black quartz, judge my vow.<br />
  <i>Sphinx of black quartz, judge my vow.</i><br />
  <b>Sphinx of black quartz, judge my vow.</b><br />
  <i><b>Sphinx of black quartz, judge my vow.</b></i><br />
</blockquote>

<blockquote style="font-family: 'Libertinus Mono', monospace;">
  Libertinus Mono<br />
  Sphinx of black quartz, judge my vow.<br />
  <i>Sphinx of black quartz, judge my vow.</i><br />
  <b>Sphinx of black quartz, judge my vow.</b><br />
  <i><b>Sphinx of black quartz, judge my vow.</b></i><br />
</blockquote>

<blockquote style="font-family: 'Libertinus Initials', serif;">
  Libertinus Initials<br />
  ABCDEFGHIJKLMNOPQRSTUVWXYZ<br />
  <i>ABCDEFGHIJKLMNOPQRSTUVWXYZ</i><br />
  <b>ABCDEFGHIJKLMNOPQRSTUVWXYZ</b><br />
  <i><b>ABCDEFGHIJKLMNOPQRSTUVWXYZ</b></i><br />
</blockquote>

<blockquote style="font-family: 'Libertinus Math', serif;">
  Libertinus Math<br />
  E = mc²<br />
  ∫ₐᵇ f(x) dx<br />
  ∑ₙ₌₁^∞ 1/n² = π²/6<br />
  ∇·E = ρ/ε₀<br />
</blockquote>

<blockquote style="font-family: 'Libertinus Keyboard', monospace;">
  Libertinus Keyboard<br />
  <br />
  Esc F1 F2 F3 F4 F5 F6 F7 F8 F9 F10 F11 F12 Del<br/>
  `1234567890-= Back<br/>
  Tab QWERTYUIOP[]\<br />
  Capslock ASDFGHJKL;' Enter<br />
  Shift ZXCVBNM,./ Shift<br />
  Ctrl Windows Alt Space Alt Fn ← ↑ ↓ →<br />
</blockquote>

<p><a style="font-variant: small-caps" href="https://developer.mozilla.org/en-US/docs/Web/CSS/font-variant-caps">Small caps</a> are available on Libertinus Serif and <span style="font-family: 'Libertinus Sans', sans-serif;">Libertinus Sans</span>:</p>

<table>
  <tr>
  <tr>
    <td>
      <code>
        &lt;span style=&quot;font-variant: small-caps;&quot;&gt;Small caps&lt;/span&gt;.
      </code>
    </td>
    <td>
      <span style="font-variant: small-caps;">Small caps</span>.
    </td>
  </tr>
  <tr>
    <td>
      <code>
        &lt;span style=&quot;font-variant: all-small-caps;&quot;&gt;All small caps&lt;/span&gt;.
      </code>
    </td>
    <td>
      <span style="font-variant: all-small-caps;">All small caps</span>.
    </td>
  </tr>
  <tr>
    <td>
      <code>
        &lt;span style=&quot;font-family: 'Libertinus Sans'; font-variant: small-caps;&quot;&gt;Small caps&lt;/span&gt;.
      </code>
    </td>
    <td>
      <span style="font-family: 'Libertinus Sans'; font-variant: small-caps;">Small caps</span>.
    </td>
  </tr>
  <tr>
    <td>
      <code>
        &lt;span style=&quot;font-family: 'Libertinus Sans'; font-variant: all-small-caps;&quot;&gt;All small caps&lt;/span&gt;.
      </code>
    </td>
    <td>
      <span style="font-family: 'Libertinus Sans'; font-variant: all-small-caps;">All small caps</span>.
    </td>
  </tr>
</table>

<h2><a href="#pairings" id="pairings"></a>3rd-party library pairings</h2>
<p>Some libraries that pair well with <cite>@celine/celine</cite> are:</p>

<h3><a id="references-web-component" href="#references-web-component"></a>References Web Component</h3>

    <p><a href="https://lab.avl.la/references-webcomponent/">References Web Component</a>, <q>an experimental pair of Web Components for citing and referencing sources in a wiki-like manner</q>.</p>

    <p>Add the following <code>&lt;script&gt;</code> element to your HTML file's <code>&lt;head&gt;</code> block:</p>

    <script src="https://lab.avl.la/references-webcomponent/references-wc.js"></script>
    <pre class="echo">&lt;script src=&quot;https://lab.avl.la/references-webcomponent/references-wc.js&quot;&gt;&lt;/script&gt;</pre></pre>

    <blockquote>
    <p>
      The Sun is hot.<cite-web url="https://www.nasa.gov/sun" author="Brian Dunbar" title="The Sun | NASA" publisher="National Aeronautics and Space Administration" date="2017-08-03" access-date="2021-08-30" data-refid="3" id="cite3"></cite-web>
    </p>
    <br />
    <b style="font-size: large;">References</b>
    <references-list style="font-family: 'Libertinus Sans', sans-serif;">
    </references-list>
    </blockquote>

    <pre class="echo">
&lt;p&gt;
  The Sun is hot.&lt;cite-web url=&quot;https://www.nasa.gov/sun&quot; author=&quot;Brian Dunbar&quot; title=&quot;The Sun | NASA&quot; publisher=&quot;National Aeronautics and Space Administration&quot; date=&quot;2017-08-03&quot; access-date=&quot;2021-08-30&quot; data-refid=&quot;3&quot; id=&quot;cite3&quot;&gt;&lt;/cite-web&gt;
&lt;/p&gt;

&lt;h2&gt;References&lt;/h2&gt;
&lt;references-list style=&quot;font-family: 'Libertinus Sans', sans-serif;&quot;&gt;
&lt;/references-list&gt;</pre>

    <h3><a id="penrose" href="#penrose"></a>Penrose</h3>

    <p><a href="https://penrose.cs.cmu.edu/">Penrose</a>, a system for creating beautiful diagrams just by typing notation in plain text.</p>

    <p>Using the <a href="https://penrose.cs.cmu.edu/docs/ref/vanilla-js"><cite>Using Penrose with Vanilla JS</cite></a> instructions:</p>

<script id="sets" type="module" class="echo reflect" contenteditable="true">
import { compile, optimize, showError, toSVG } from "https://ga.jspm.io/npm:@penrose/core@3.2.0/dist/bundle/index.js"

const trio = {
  substance: `
    Set A, B, C, D, E, F, G

    Subset(B, A)
    Subset(C, A)
    Subset(D, B)
    Subset(E, B)
    Subset(F, C)
    Subset(G, C)

    Disjoint(E, D)
    Disjoint(F, G)
    Disjoint(B, C)

    AutoLabel All
  `,
  style: `
    canvas {
      width = 800
      height = 300
    }

    forall Set x {
      shape x.icon = Circle { }
      shape x.text = Equation {
        string : x.label
        fontSize : "32px"
      }
      ensure contains(x.icon, x.text)
      encourage norm(x.text.center - x.icon.center) == 0
      layer x.text above x.icon
    }

    forall Set x; Set y
    where Subset(x, y) {
      ensure disjoint(y.text, x.icon, 10)
      ensure contains(y.icon, x.icon, 5)
      layer x.icon above y.icon
    }

    forall Set x; Set y
    where Disjoint(x, y) {
      ensure disjoint(x.icon, y.icon)
    }

    forall Set x; Set y
    where Intersecting(x, y) {
      ensure overlapping(x.icon, y.icon)
      ensure disjoint(y.text, x.icon)
      ensure disjoint(x.text, y.icon)
    }
  `,
  domain: `
    type Set
    predicate Disjoint(Set s1, Set s2)
    predicate Intersecting(Set s1, Set s2)
    predicate Subset(Set s1, Set s2)`,
  variation: `test`,
};

celine.cell("sets", async () => {
  await celine.library.Promises.delay(1000); // weirdly necessary

  const compiled = await compile(trio);
  if (compiled.isErr()) {
    return showError(compiled.error);
  }

  const optimized = optimize(compiled.value);
  if (optimized.isErr()) {
    return showError(optimized.error);
  }

  return toSVG(optimized.value);
});
</script>


<p>
  <a href="https://penrose.cs.cmu.edu/docs/bloom/tutorial/getting_started">Bloom</a> lets you build optimization-driven interactive diagrams in JavaScript.
</p>

<script type="module" class="echo reflect" id="bloom" contenteditable="true">
import * as bloom from "https://penrose.cs.cmu.edu/bloom.min.js";

const db = new bloom.DiagramBuilder(bloom.canvas(400, 400), "abcd", 1);
const { type, predicate, forall, forallWhere, ensure, circle, line } = db;

const pointRad = 30;
const pointMargin = 10;

const Point = type();
const Arrow = type();
const Connects = predicate();

const p1 = Point();
const p2 = Point();
const arrow = Arrow();
Connects(arrow, p1, p2);

forall({ p: Point }, ({ p }) => {
  p.icon = circle({
    r: pointRad,
    drag: true,
  });
});

forallWhere(
  { a: Arrow, p: Point, q: Point },
  ({ a, p, q }) => Connects.test(a, p, q),
  ({ a, p, q }) => {
    const pq = bloom.ops.vsub(q.icon.center, p.icon.center); // vector from p to q
    const pqNorm = bloom.ops.vnormalize(pq); // direction from p to q
    const pStart = bloom.ops.vmul(pointRad + pointMargin, pqNorm); // vector from p to line start
    const start = bloom.ops.vadd(p.icon.center, pStart); // line start
    const end = bloom.ops.vsub(q.icon.center, pStart); // line end

    a.icon = line({
      start: start,
      end: end,
      endArrowhead: "straight",
    });

    ensure(
      bloom.constraints.greaterThan(
        bloom.ops.vdist(p.icon.center, q.icon.center),
        2 * (pointRad + pointMargin) + 20,
      ),
    );
  },
);

celine.cell("bloom", async () => {
  const diagram = await db.build();
  return diagram.getInteractiveElement();
});
</script>


<h2><a href="#changelog" id="changelog"></a>Changelog <a href="changelog.xml"><img src="static/rss.svg" alt="RSS feed icon" style="width: 1ch; height: 1ch; vertical-align: middle; display: inline-block;"></a></h2>

<p>
  <cite>@celine/celine</cite> uses <a href="https://semver.org/">Semantic Versioning 2.0.0</a>.
  Because <cite>@celine/celine</cite> exports <a href="#libertine.css">libertine.css</a> as part of its API, any styling change is considered an incompatible change and necessitates a MAJOR version bump.
</p>

<p>The 10 most recent entries from the <a href="changelog.xml">changelog.xml</a>:</p>

<table>
  <thead>
    <tr>
      <th>Version</th>
      <th>Date</th>
      <th>Changes</th>
    </tr>
  </thead>
  <tbody id="changelog-table-body">
    <!-- rows get inserted here-->
  </tbody>
  <script type="module">
    fetch('changelog.xml')
      .then(response => response.text())
      .then(data => {
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(data, 'application/xml');
        const entries = Array.from(xmlDoc.getElementsByTagName('entry')).slice(0, 10);
        let tableRows = '';
        for (let entry of entries) {
            const version = entry.getElementsByTagName('title')[0].textContent;
            const link = entry.getElementsByTagName('link')[0].getAttribute('href');
            const changes = entry.getElementsByTagName('summary')[0].textContent;
            let date = entry.getElementsByTagName('updated')[0].textContent;
            date = new Date(date).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
          tableRows += `<tr><td><a href="${link}">${version}</a></td><td>${date}</td><td>${changes}</td></tr>`;
        }
        document.getElementById('changelog-table-body').innerHTML = tableRows;
      })
      .catch(error => console.error('Error loading changelog:', error));
  </script>
</table>

<h2><a href="#resources" id="resources"></a>Resources</h2>

<ul>
  <li><a href="https://github.com/observablehq/runtime">Observable Runtime</a></li>
  <li><a href="https://github.com/observablehq/inputs">Observable Inputs</a></li>
  <li><a href="https://github.com/observablehq/stdlib">Observable standard library</a></li>
  <li><a href="https://observablehq.com/@observablehq/how-observable-runs"><cite>How Observable Runs</cite></a></li>
  <li><a href="https://observablehq.com/@observablehq/synchronized-inputs"><cite>Synchronized Inputs</cite></a></li>
  <li><a href="https://observablehq.com/@observablehq/module-require-debugger">Module require debugger</a></li>
  <li><a href="https://observablehq.com/plot/what-is-plot">Observable Plot</a></li>
  <li><a href="https://maxbo.me/a-html-file-is-all-you-need.html"><cite>Reactive HTML Notebooks</cite></a></li>
</ul>

<!-- <div style="text-align: center; margin-top: 4ch;">
<pre style="max-width: 100%; overflow-x: auto;">

  _..._                                                                
  .-'_..._''.                    .---.                                    
.' .'      '.\     __.....__     |   |.--.   _..._         __.....__      
/ .'            .-''         '.   |   ||__| .'     '.   .-''         '.    
. '             /     .-''"'-.  `. |   |.--..   .-.   . /     .-''"'-.  `.  
| |            /     /________\   \|   ||  ||  '   '  |/     /________\   \ 
| |            |                  ||   ||  ||  |   |  ||                  | 
. '            \    .-------------'|   ||  ||  |   |  |\    .-------------' 
\ '.          .\    '-.____...---.|   ||  ||  |   |  | \    '-.____...---. 
'. `._____.-'/ `.             .' |   ||__||  |   |  |  `.             .'  
  `-.______ /    `''-...... -'   '---'    |  |   |  |    `''-...... -'    
           `                              |  |   |  |                     
                                          '--'   '--'                     
</pre>
</div> -->

</main>
</body>
</html>
